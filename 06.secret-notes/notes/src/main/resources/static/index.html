<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Plain-Text Encrypted Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 全域設定與色彩變數 */
        :root {
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --color-bg: #121212;
            --color-card-bg: #1e1e1e;
            --color-text-main: #f0f0f0;
            --color-text-muted: #aaaaaa;
            --color-primary: #007bff;
            --color-primary-dark: #0056b3;
            --border-radius-lg: 1rem;
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text-main);
            font-family: var(--font-family);
            line-height: 1.6;
        }

        /* 容器與版面 */
        .container-custom {
            max-width: 800px;
        }

        .header-title {
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* 卡片樣式 */
        .card {
            background-color: var(--color-card-bg);
            border: none;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.6);
        }

        /* 表單元件 */
        .form-label {
            color: #ffffff; /* 確保表單標籤為純白色，提供高對比 */
        }

        .form-control {
            background-color: #2b2b2b;
            border: 1px solid #444;
            color: var(--color-text-main);
            border-radius: 0.5rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            background-color: #2b2b2b;
            color: var(--color-text-main);
            border-color: var(--color-primary);
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
        }

        .form-control::placeholder {
            color: #6c757d;
        }

        /* 按鈕樣式 */
        .btn-primary {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
            border-color: var(--color-primary-dark);
        }

        .btn-outline-light {
            border-color: #555;
            color: var(--color-text-main);
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .btn-outline-light:hover {
            background-color: #444;
            border-color: #555;
        }

        /* 額外輔助樣式 */
        .muted {
            color: var(--color-text-muted);
        }

        a, a:visited {
            color: var(--color-primary);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--color-primary-dark);
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        }

        pre {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 0.5rem;
            padding: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
<main class="container container-custom py-5">
    <header class="mb-5 text-center">
        <h1 class="header-title text-uppercase">Plain-Text Encrypted Notes</h1>
        <p class="muted mt-2">您的私密筆記，端對端加密，伺服器零明文留存。</p>
    </header>

    <div class="row g-4">
        <div class="col-12 col-lg-6">
            <div class="card p-4">
                <h2 class="h5 mb-3">建立新記事</h2>
                <div class="mb-3">
                    <label class="form-label">標題</label>
                    <input id="create-title" class="form-control" placeholder="例如：會議備忘錄">
                </div>
                <div class="mb-3">
                    <label class="form-label">內容（純文字）</label>
                    <textarea id="create-plain" class="form-control mono" rows="6" placeholder="在此輸入您的筆記內容..."></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">密碼</label>
                    <input id="create-pass" type="password" class="form-control" placeholder="至少 8 個字元">
                </div>
                <div class="d-flex gap-2">
                    <button id="btn-create" class="btn btn-primary w-100">儲存</button>
                    <button id="btn-clear" class="btn btn-outline-light w-100">清除</button>
                </div>
                <div id="create-result" class="mt-3 muted"></div>
            </div>
        </div>

        <div class="col-12 col-lg-6">
            <div class="card p-4">
                <h2 class="h5 mb-3">解密並讀取記事</h2>
                <div class="mb-3">
                    <label class="form-label">記事 ID</label>
                    <input id="read-id" class="form-control mono" placeholder="UUID">
                </div>
                <div class="mb-3">
                    <label class="form-label">密碼</label>
                    <input id="read-pass" type="password" class="form-control" placeholder="輸入您的密碼">
                </div>
                <button id="btn-read" class="btn btn-primary w-100">解密並讀取</button>
                <pre id="read-output" class="mt-3 mono muted"></pre>
            </div>
        </div>
    </div>

    <footer class="mt-5 text-center muted">
        <small>安全提醒：實務上，建議採用 <code>POST</code> 請求來傳送密碼，避免其出現在 URL 或瀏覽器歷史紀錄中。</small>
    </footer>
</main>

<script>
    // 建立記事
    document.getElementById('btn-create').addEventListener('click', async () => {
        const title = document.getElementById('create-title').value.trim();
        const plainText = document.getElementById('create-plain').value;
        const pass = document.getElementById('create-pass').value;
        const res = await fetch('/notes', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ title, plainText, pass })
        });
        const el = document.getElementById('create-result');
        if (res.ok) {
            const data = await res.json();
            el.textContent = `已成功建立：ID=${data.id}`;
            // 清空表單
            document.getElementById('create-title').value = '';
            document.getElementById('create-plain').value = '';
            document.getElementById('create-pass').value = '';
        } else {
            const err = await res.json().catch(()=>({message: res.statusText}));
            el.textContent = `錯誤：${res.status} ${err.message || ''}`;
        }
    });

    // 清空表單
    document.getElementById('btn-clear').addEventListener('click', () => {
        ['create-title','create-plain','create-pass'].forEach(id => document.getElementById(id).value='');
        document.getElementById('create-result').textContent = '';
    });

    // 解密讀取（題意：GET + query）
    document.getElementById('btn-read').addEventListener('click', async () => {
        const id = document.getElementById('read-id').value.trim();
        const pass = encodeURIComponent(document.getElementById('read-pass').value);
        const out = document.getElementById('read-output');
        const res = await fetch(`/notes/${id}?pass=${pass}`);
        if (res.ok) {
            const data = await res.json();
            out.textContent = data.plainText;
        } else {
            const err = await res.json().catch(()=>({message: res.statusText}));
            out.textContent = `錯誤：${res.status} ${err.message || ''}`;
        }
    });
</script>
</body>
</html>