<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Echo & Time Service Client</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">Echo & Time Service Client</h1>

    <div class="card mb-4">
        <div class="card-header fw-bold">POST /echo 測試</div>
        <div class="card-body">
            <div class="mb-3">
                <label for="echoText" class="form-label">輸入文字</label>
                <textarea id="echoText" class="form-control" rows="3" placeholder="輸入任意文字"></textarea>
            </div>
            <button id="btnEcho" class="btn btn-primary">送出請求</button>
            <pre id="echoResult" class="mt-3 bg-body-tertiary p-3 border rounded" style="white-space:pre-wrap"></pre>
        </div>
    </div>

    <div class="card">
        <div class="card-header fw-bold">GET /now 測試</div>
        <div class="card-body">
            <div class="row g-2 align-items-end">
                <div class="col-sm-6">
                    <label for="tz" class="form-label">IANA 時區（選填）</label>
                    <input id="tz" class="form-control" placeholder="Asia/Tokyo" list="tzList">
                    <datalist id="tzList">
                        <option value="Asia/Tokyo"></option>
                        <option value="UTC"></option>
                        <option value="Europe/Paris"></option>
                        <option value="America/Los_Angeles"></option>
                        <option value="Asia/Taipei"></option>
                    </datalist>
                </div>
                <div class="col-auto">
                    <button id="btnNow" class="btn btn-success">取得當前時間</button>
                </div>
            </div>
            <pre id="nowResult" class="mt-3 bg-body-tertiary p-3 border rounded"></pre>
        </div>
    </div>
</div>

<script>
    // API 伺服器基礎 URL，同域部署時留空
    const apiBase = "";

    // 處理 POST /echo 請求
    async function postEcho() {
        const text = document.getElementById('echoText').value;
        const resBox = document.getElementById('echoResult');
        resBox.textContent = "執行中…"; // 顯示載入中狀態

        try {
            const resp = await fetch(`${apiBase}/echo`, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ text })
            });

            const json = await resp.json();
            // 檢查 HTTP 狀態碼，如果不是 2xx 則視為錯誤
            if (!resp.ok) {
                resBox.textContent = `錯誤 ${resp.status}：\n${JSON.stringify(json, null, 2)}`;
            } else {
                resBox.textContent = JSON.stringify(json, null, 2);
            }
        } catch (e) {
            resBox.textContent = `發生錯誤：${e.message || e}`;
        }
    }

    // 處理 GET /now 請求
    async function getNow() {
        const tz = document.getElementById('tz').value.trim();
        const resBox = document.getElementById('nowResult');
        resBox.textContent = "執行中…"; // 顯示載入中狀態

        const url = tz ? `${apiBase}/now?tz=${encodeURIComponent(tz)}` : `${apiBase}/now`;
        try {
            const resp = await fetch(url);
            const json = await resp.json();
            // 檢查 HTTP 狀態碼，如果不是 2xx 則視為錯誤
            if (!resp.ok) {
                resBox.textContent = `錯誤 ${resp.status}：\n${JSON.stringify(json, null, 2)}`;
            } else {
                resBox.textContent = JSON.stringify(json, null, 2);
            }
        } catch (e) {
            resBox.textContent = `發生錯誤：${e.message || e}`;
        }
    }

    // 綁定按鈕點擊事件
    document.getElementById('btnEcho').addEventListener('click', postEcho);
    document.getElementById('btnNow').addEventListener('click', getNow);
</script>
</body>
</html>